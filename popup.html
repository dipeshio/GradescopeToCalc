<!DOCTYPE html>
<html>
<head>
  <title>Gradescope to Google Calendar</title>
  <link rel="stylesheet" href="popup.css">
  <meta charset="utf-8">
</head>

<body>
  <div class="container">
    <header>
      <h1>ğŸ“ Gradescope to Tasks</h1>
      <p class="subtitle">Sync your assignments automatically</p>
    </header>

    <main>
      <!-- OAuth Configuration -->
      <div class="config-section" id="configSection">
        <h3>ğŸ”§ Setup Required</h3>
        <p class="config-help">Enter your Google OAuth Client ID to get started:</p>
        <div class="config-form">
          <input type="text" id="clientIdInput" class="config-input" 
                 placeholder="your-client-id.apps.googleusercontent.com">
          <button id="saveConfigButton" class="btn btn-primary">Save Configuration</button>
        </div>
        <div class="config-links">
          <a href="#" id="setupGuideLink" class="help-link">ğŸ“– How to get Client ID</a>
        </div>
      </div>

      <!-- Authentication Status -->
      <div class="auth-section" id="authSection" style="display: none;">
        <div id="authStatus" class="status-indicator">
          <span class="status-dot" id="authDot"></span>
          <span id="authText">Checking authentication...</span>
        </div>
        <button id="authButton" class="btn btn-primary" style="display: none;">
          Connect Google Tasks
        </button>
        <button id="reconfigureButton" class="btn btn-secondary" style="display: none;">
          Change Client ID
        </button>
      </div>

      <!-- Current Course Info -->
      <div class="course-section" id="courseSection" style="display: none;">
        <h3>ğŸ“š Current Course</h3>
        <div id="courseInfo" class="course-info">
          <span id="courseName">No course detected</span>
        </div>
      </div>

      <!-- Assignments List -->
      <div class="assignments-section" id="assignmentsSection" style="display: none;">
        <h3>ğŸ“ Assignments Found</h3>
        <div id="assignmentsList" class="assignments-list"></div>
      </div>

      <!-- Sync Controls -->
      <div class="sync-section">
        <div class="sync-controls">
          <button id="syncButton" class="btn btn-primary">
            <span id="syncIcon">ğŸ”„</span>
            <span id="syncText">Sync to Tasks</span>
          </button>
          
          <label class="toggle-label">
            <input type="checkbox" id="autoSyncToggle">
            <span class="toggle-slider"></span>
            Auto-sync assignments
          </label>
        </div>

        <div id="syncStatus" class="sync-status" style="display: none;">
          <div id="syncProgress" class="progress-bar">
            <div id="syncProgressFill" class="progress-fill"></div>
          </div>
          <div id="syncMessage" class="sync-message"></div>
        </div>
      </div>

      <!-- Sync Results -->
      <div class="results-section" id="resultsSection" style="display: none;">
        <h3>ğŸ“Š Sync Results</h3>
        <div id="syncResults" class="sync-results"></div>
      </div>

      <!-- Settings -->
      <div class="settings-section">
        <details class="settings-details">
          <summary>âš™ï¸ Settings</summary>
          <div class="settings-content">
            <label>
              Sync Interval:
              <select id="syncInterval">
                <option value="5" selected>5 minutes</option>
                <option value="15">15 minutes</option>
                <option value="30">30 minutes</option>
                <option value="60">1 hour</option>
                <option value="180">3 hours</option>
              </select>
            </label>
            
            <div class="sync-stats">
              <div class="stat">
                <span class="stat-label">Synced Assignments:</span>
                <span id="syncedCount">0</span>
              </div>
              <div class="stat">
                <span class="stat-label">Last Sync:</span>
                <span id="lastSync">Never</span>
              </div>
              <div class="stat">
                <span class="stat-label">Auto-Sync Status:</span>
                <span id="autoSyncStatus">Checking...</span>
              </div>
            </div>
            
            <div class="debug-section" style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e9ecef;">
              <div style="display: flex; gap: 8px;">
                <button id="debugAutoSync" class="btn" style="background: #6c757d; color: white; font-size: 11px; padding: 6px 8px;">Debug Auto-Sync</button>
                <button id="testAutoSync" class="btn" style="background: #17a2b8; color: white; font-size: 11px; padding: 6px 8px;">Test Auto-Sync</button>
              </div>
            </div>
          </div>
        </details>
      </div>
    </main>

    <footer>
      <div class="help-section">
        <p class="help-text">
          ğŸ’¡ Automatic syncing every 5 minutes â€¢ Visit course pages for instant sync<br>
          <small>â° Due times appear in task notes (Google Tasks limitation)</small>
        </p>
      </div>
    </footer>
  </div>

  <script src="popup.js"></script>
</body>
</html>